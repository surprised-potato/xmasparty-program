<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UNO-R Master Digital Script 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --unor-blue: #002D62;
            --unor-gold: #FFD700;
            --text-white: #ffffff;
            --bg-dark: #001a35;
            --vo-gray: #34495e;
            --festive-green: #27ae60;
        }
        .seq-num-top {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 0.9rem;
            font-weight: 900;
            color: var(--unor-gold);
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 12px;
            border-radius: 5px;
            letter-spacing: 2px;
        }

        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; font-family: 'Montserrat', sans-serif; background-color: var(--bg-dark); }

        /* Progress Bar */
        /* Find this in your CSS and change top to bottom */
        .progress-nav { 
            position: fixed; 
            bottom: 0;      /* Changed from top: 0 */
            left: 0; 
            width: 100%; 
            height: 8px; 
            background: rgba(255,255,255,0.1); 
            z-index: 1000; 
        }
        
        .progress-bar { 
            height: 100%; 
            background: #FFD700; /* Gold Color */
            width: 0%;           /* Start at zero */
            transition: width 0.2s ease-out; 
            box-shadow: 0 0 10px #FFD700; 
        }

        /* Nav Arrows */
        .nav-arrow { position: fixed; top: 50%; transform: translateY(-50%); background: rgba(255, 215, 0, 0.2); color: var(--unor-gold); border: 2px solid var(--unor-gold); padding: 15px; border-radius: 50%; cursor: pointer; z-index: 1001; font-size: 1.5rem; width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; }
        .prev { left: 15px; } .next { right: 15px; }

        /* Swipe Container */
        /* Update this section */
        .slider { 
            display: flex; 
            overflow-x: auto; 
            overflow-y: hidden; /* Prevents container from wobbling vertically */
            scroll-snap-type: x mandatory; 
            scroll-behavior: smooth; 
            height: 100dvh; /* Uses Dynamic Height to account for mobile bars */
            width: 100vw; 
            -webkit-overflow-scrolling: touch; 
        }
        .slider::-webkit-scrollbar { display: none; }

        /* Slide Cards */
        /* Update this section */
        .slide { 
            flex: 0 0 100vw; 
            width: 100vw; 
            height: 100dvh; /* Fixes "not scrolling all the way" on mobile */
            scroll-snap-align: start; 
            scroll-snap-stop: always; /* FIX: Only swipes ONE card at a time */
            
            padding: 60px 40px 200px 40px; /* Added 100px bottom padding buffer */
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start; 
            position: relative; 
            overflow-y: auto; /* Allows vertical scrolling for long scripts */
            -webkit-overflow-scrolling: touch;
        }
        .header { margin-bottom: 20px; border-bottom: 3px solid var(--unor-gold); padding-bottom: 10px; }
        .header h2 { font-family: 'Playfair Display', serif; color: var(--unor-gold); margin: 0; font-size: 1.8rem; text-transform: uppercase; }
        .header p { color: #bdc3c7; font-size: 0.9rem; margin: 5px 0; font-weight: 700; letter-spacing: 1px; }

        .section { background: rgba(255,255,255,0.07); margin: 10px 0; padding: 20px; border-radius: 15px; border-left: 5px solid transparent; }
        .label { font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1.5px; }
        
        .bridge-section { border-left-color: #e67e22; }
        .intro-section { border-left-color: #3498db; }
        .thank-section { border-left-color: var(--festive-green); }

        .content { font-size: 1.15rem; line-height: 1.6; color: var(--text-white); }
        .bridge-text { font-style: italic; color: #e67e22; }
        .thank-text { font-weight: 700; color: var(--festive-green); }
        .dept-list { font-size: 0.85rem; color: #ecf0f1; margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; font-weight: 400; display: block; }
        
        .vo-badge { background: #c0392b; color: white; padding: 4px 10px; border-radius: 5px; font-size: 0.7rem; margin-right: 10px; vertical-align: middle; }
        .seq-num { position: absolute; top: 65px; right: 80px; font-size: 3rem; color: rgba(255,255,255,0.05); font-weight: 900; }

        @media (max-width: 768px) {
            .slide { padding: 50px 30px; }
            .nav-arrow { display: none; }
            .seq-num { right: 30px; font-size: 2rem; }
            .swipe-hint { display: flex !important; }
        }

        /* Swipe Hint Animation */
        .swipe-hint {
            position: fixed;
            bottom: 40px;
            right: 20px;
            color: var(--unor-gold);
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 1500;
            display: none;
            align-items: center;
            gap: 5px;
            pointer-events: none;
            animation: swipeAnim 1.5s infinite ease-in-out;
            transition: opacity 0.5s;
        }
        @keyframes swipeAnim {
            0%, 100% { transform: translateX(0); opacity: 0.6; }
            50% { transform: translateX(-10px); opacity: 1; }
        }

        /* Print Button */
        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            background: var(--unor-gold);
            color: var(--unor-blue);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-family: 'Montserrat', sans-serif;
        }

        /* Slide Manager Styles */
        .manager-btn {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 2000;
            background: var(--unor-blue);
            color: var(--unor-gold);
            border: 1px solid var(--unor-gold);
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-family: 'Montserrat', sans-serif;
        }

        .modal { display: none; position: fixed; z-index: 4000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 10px; color: #333; max-height: 90vh; overflow-y: auto; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
        
        .slide-list-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 20px; }
        .manager-card { background: #eee; padding: 10px; border-radius: 8px; transition: transform 0.2s; border: 2px solid transparent; display: flex; flex-direction: column; justify-content: space-between; min-height: 140px; }
        .manager-card:hover { transform: scale(1.05); border-color: var(--unor-blue); }
        .manager-card-content { cursor: pointer; flex-grow: 1; }
        .card-controls { display: flex; justify-content: space-between; margin-top: 10px; border-top: 1px solid #ccc; padding-top: 5px; }
        .card-controls button { background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 0 5px; color: #555; }
        .card-controls button:hover { color: var(--unor-blue); transform: scale(1.2); }
        .card-controls button:disabled { color: #ccc; cursor: default; transform: none; }
        .btn-delete:hover { color: #c0392b !important; }
        .add-slide-btn { display: flex; align-items: center; justify-content: center; background: white; border: 2px dashed #ccc; color: #888; font-weight: bold; cursor: pointer; min-height: 140px; border-radius: 8px; transition: all 0.2s; }
        .add-slide-btn:hover { border-color: var(--unor-blue); color: var(--unor-blue); background: #f0f8ff; }
        .manager-card h4 { margin: 0 0 5px 0; font-size: 0.9rem; color: var(--unor-blue); }
        .manager-card p { margin: 0; font-size: 0.7rem; color: #666; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit; }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .section-edit-group { background: #f9f9f9; padding: 15px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; position: relative; }
        .btn-remove-section { position: absolute; top: 10px; right: 10px; color: #c0392b; background: none; border: none; font-size: 1.2rem; cursor: pointer; }
        
        .modal-actions { text-align: right; margin-bottom: 20px; }
        .modal-actions button { padding: 8px 16px; margin-left: 10px; cursor: pointer; border-radius: 4px; border: none; font-weight: bold; }
        .btn-save { background: var(--festive-green); color: white; }
        .btn-cancel { background: #c0392b; color: white; }

        @media print {
            .print-btn, .manager-btn, .nav-arrow, .progress-nav, .modal { display: none !important; }
            body, html { height: auto; overflow: visible; background: white; }
            .slider { display: block; height: auto; overflow: visible; width: 100%; }
            .slide {
                width: 100%; height: auto; page-break-inside: avoid; break-inside: avoid;
                border-bottom: 1px solid #ccc; margin-bottom: 20px; padding: 20px;
                color: black; background: white !important; flex: none; display: block;
            }
            .content, .header h2, .header p, .label, .dept-list { color: black !important; }
            .seq-num, .seq-num-top { color: #ddd !important; text-shadow: none; position: relative; top: auto; right: auto; left: auto; float: right; font-size: 1.5rem; background: none; padding: 0; }
            .section { background: none; border: 1px solid #eee; padding: 10px; }
            .bridge-text { color: #d35400 !important; } .thank-text { color: #27ae60 !important; }
        }
    </style>
</head>
<body>


<div class="nav-arrow prev" onclick="moveSlide(-1)">&#10094;</div>
<div class="nav-arrow next" onclick="moveSlide(1)">&#10095;</div>
<div class="swipe-hint">SWIPE &#10095;&#10095;</div>
<button class="print-btn" onclick="window.print()">&#128424; Print Script</button>
<button class="manager-btn" onclick="openSlideManager()">&#9881; Manage Slides</button>

<!-- Modals -->
<div id="managerModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('managerModal')">&times;</span>
        <h2>Slide Manager</h2>
        <div id="slideList" class="slide-list-grid"></div>
    </div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('editModal')">&times;</span>
        <h2>Edit Slide</h2>
        <div class="modal-actions">
            <button class="btn-save" onclick="saveSlide()">Save</button>
            <button class="btn-cancel" onclick="closeModal('editModal')">Cancel</button>
        </div>
        <div id="editForm"></div>
    </div>
</div>

<div id="statusModal" class="modal">
    <div class="modal-content" style="text-align: center; max-width: 400px;">
        <span class="close" onclick="closeModal('statusModal')">&times;</span>
        <h2 id="statusTitle" style="color: var(--unor-blue);"></h2>
        <p id="statusMessage"></p>
        <button class="btn-save" onclick="closeModal('statusModal')">OK</button>
    </div>
</div>

<div class="slider" id="slider">
    <!-- Content will be injected via JavaScript -->
</div>

<div class="progress-nav"><div class="progress-bar" id="progressBar"></div></div>

<script>
    const slider = document.getElementById('slider');
    const progressBar = document.getElementById('progressBar');

    // This listens specifically for the horizontal swipe
    slider.addEventListener('scroll', () => {
        const scrollLeft = slider.scrollLeft;
        const maxScroll = slider.scrollWidth - slider.clientWidth;
        
        if (maxScroll > 0) {
            // Calculate progress percentage
            const percentage = (scrollLeft / maxScroll) * 100;
            // Update the width of the gold bar
            progressBar.style.width = percentage + '%';
        }

        // Hide swipe hint once user starts scrolling
        const hint = document.querySelector('.swipe-hint');
        if (hint && scrollLeft > 50) hint.style.opacity = '0';
    });

    function moveSlide(direction) {
        slider.scrollBy({ left: direction * slider.clientWidth, behavior: 'smooth' });
    }

    // Firebase Configuration
    const firebaseConfig = {

    apiKey: "AIzaSyB-6OZBYnTJAQXHlDwmZ5G47OGSaY6zc4I",

    authDomain: "uno-r-xmas-script.firebaseapp.com",

    projectId: "uno-r-xmas-script",

    storageBucket: "uno-r-xmas-script.firebasestorage.app",

    messagingSenderId: "852772658090",

    appId: "1:852772658090:web:e1910235ee02c96f7c29d3"

    };


    // Initialize Firebase
    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
    } catch (e) {
        console.error("Firebase init error. Check config.", e);
    }

    let scriptData = [];
    const defaultScriptData = [
        {
            seqNum: "01",
            style: "background: var(--vo-gray);",
            header: { badge: "VOICE OVER", title: "Spiritual Opening", subtitle: "Off-Stage Audio Only" },
            sections: [
                { type: "intro-section", label: "The Script", content: `"Good evening, UNO-Rians! To begin this holy and festive night, let us all stand in reverence for the Invocation, to be rendered in music by the <b>Kapawa Choir</b> and in words by <b>Rev. Fr. Leo G. Alaras, OAR</b>, our VP for Identity, Formation, and Mission."` }
            ]
        },
        {
            seqNum: "02",
            style: "background: var(--vo-gray);",
            header: { badge: "VOICE OVER", title: "National Pride", subtitle: "Off-Stage Audio Only" },
            sections: [
                { type: "intro-section", label: "The Script", content: `"Please remain standing for the Philippine National Anthem."` }
            ]
        },
        {
            seqNum: "03",
            style: "background: var(--vo-gray);",
            header: { badge: "VOICE OVER", title: "Host Showcase", subtitle: "Off-Stage Audio Only" },
            sections: [
                { type: "intro-section", label: "The Script", content: `"Everyone may now be seated. Please enjoy a special AVP presentation on our theme for 2025: <b>'Rise... Rebuild... Celebrate Christmas!'</b> followed immediately by the high-energy opening production number from our official hosts—the <b>College of Engineering (COEN)</b>!"` }
            ]
        },
        {
            seqNum: "04",
            header: { title: "Erl, Rue, Dan, & Mark", subtitle: "Host Entrance" },
            sections: [
                { type: "bridge-section", label: "The Bridge", content: "Erl, Rue, Dan, and Mark walk on stage with big energy, applauding COEN.", contentClass: "bridge-text" },
                { type: "intro-section", label: "The Intro", content: `"Whooo! Bacolod, can you feel that Engineering energy?! Good evening, UNO-R! We are your hosts for this spectacular night—I'm <b>Erl</b>, and with me are <b>Rue, Dan, and Mark!</b>"` },
                { type: "intro-section", label: "The Spirit", content: `"Tonight is all about gratitude. We've Risen, we've Rebuilt, and now—it's time to Celebrate Christmas as one Recoleto family!"` }
            ]
        },
        {
            seqNum: "05",
            header: { title: "Father President", subtitle: "President's Message" },
            sections: [
                { type: "intro-section", label: "The Intro", content: `"To share a message of hope that lights up our path like the star of Bethlehem, let us welcome our Father President, <b>Rev. Fr. Joel A. Alve, OAR.</b>"` },
                { type: "thank-section", label: "Improved Thank You", content: `"Thank you, Fr. Joel! Your words are like the hanging of the first Christmas lights, inspiring, colorfully bright ,and reminding us of the beauty of our mission."`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "06",
            header: { title: "The Christmas Feast", subtitle: "Dinner & Minor Raffles" },
            sections: [
                { type: "bridge-section", label: "The Bridge", content: `"Fr. Joel fed our souls; now let’s let the Acacia buffet feed our appetites!"`, contentClass: "bridge-text" },
                { type: "intro-section", label: "The Intro", content: `"Dinner is officially served! Dig in, enjoy the music, and keep your raffle tickets handy—we’re drawing our <b>Minor Prizes</b> while you dine!"` }
            ]
        },
        {
            seqNum: "07",
            header: { title: "Program Part 2", subtitle: "Lay Admin Opener" },
            sections: [
                { type: "bridge-section", label: "The Bridge", content: `"I hope your stomachs are full because it’s time to fill the stage with talent!"`, contentClass: "bridge-text" },
                { type: "intro-section", label: "The Intro", content: `"Welcome to Part 2! Opening our Musical Show, let’s welcome the **Lay Admin** with the holiday anthem: <b>'All I Want for Christmas!'</b>"` },
                { type: "thank-section", label: "Improved Thank You", content: `"What a charming start! If all you want for Christmas is talent, the Lay Admin just delivered it in spades!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "08",
            header: { title: "Cluster 1", subtitle: "Song: It's Like an Earthquake" },
            sections: [
                { type: "intro-section", label: "The Intro", content: `"Every rebuilding process starts with a shake-up! Let’s feel the ground move with Cluster 1!"`, deptList: "Featuring: President's Office, Planning, QA, Marketing, Library, STEP, ETEEAP, & REED." },
                { type: "thank-section", label: "Improved Thank You", content: `"That was ground-breaking! Thank you, Cluster 1, for shaking off the dust and rising to the occasion!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "09",
            header: { title: "Cluster 2", subtitle: "Song: I Will Survive" },
            sections: [
                { type: "intro-section", label: "The Intro", content: `"They are the backbone of our admin operations, and they prove that no matter the challenge, we are survivors! Here is Cluster 2!"`, deptList: "Featuring: VP-Admin, HRMDO, SSD, ICTD, Registrar, & SDPC." },
                { type: "thank-section", label: "Improved Thank You", content: `"Survival never looked so glamorous! Thank you, Cluster 2, for that incredible disco-powered resilience!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "10",
            header: { title: "Cluster 3", subtitle: "Song: Here Comes the Rain Again" },
            sections: [
                { type: "intro-section", label: "The Intro", content: `"You can’t have growth without a little rain. Let’s welcome our academics and researchers who nurture our community. Cluster 3!"`, deptList: "Featuring: VP-Academics & Research and Integrated School." },
                { type: "thank-section", label: "Improved Thank You", content: `"That was refreshing! Thank you, Cluster 3, for washing away the challenges and bringing the growth!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "11",
            header: { title: "Cluster 4", subtitle: "Song: Rock and Roll" },
            sections: [
                { type: "intro-section", label: "The Intro", content: `"We built this institution on a solid foundation of faith... and a little bit of Rock and Roll! Get loud for Cluster 4!"`, deptList: "Featuring: VP-Academics & Research and all Colleges." },
                { type: "thank-section", label: "Improved Thank You", content: `"You guys didn't just build this city; you rocked this ballroom! What an electric performance!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "12",
            header: { title: "Cluster 5", subtitle: "Songs: Staying Alive / Get Loud" },
            sections: [
                { type: "intro-section", label: "The Intro", content: `"It’s time for the grand finale of our musical show! They’re staying alive and they’re getting LOUD! Here is Cluster 5!"`, deptList: "Featuring: VP-IFM, DSA, Accounting, Property, MIS, & Maintenance teams." },
                { type: "thank-section", label: "Improved Thank You", content: `"Now THAT is how you celebrate! Thank you, Cluster 5, for bringing the house down and the spirits up!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "IX",
            seqClass: "seq-num-top",
            header: { title: "Holiday Small Wonders", subtitle: "MINOR RAFFLE DRAW" },
            sections: [
                { type: "intro-section", label: "The Script", content: `"Like the secret surprises hidden in our Christmas stockings, it’s time to reveal our <b>Minor Raffle winners!</b> Let’s share the spirit of giving and see whose Yuletide just got a little brighter. Erl, Rue, help me out—who's our first winner?"` },
                { type: "thank-section", label: "Thank You", content: `"Congratulations to our winners! May these small wonders be just the beginning of your holiday blessings!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "X",
            seqClass: "seq-num-top",
            header: { title: "Unwrapping the Unexpected", subtitle: "A CHRISTMAS MYSTERY PERFORMANCE" },
            sections: [
                { type: "bridge-section", label: "The Bridge", content: `"You know that feeling of looking at a mystery gift under the tree and wondering what’s inside? Well, it's time to find out!"`, contentClass: "bridge-text" },
                { type: "intro-section", label: "The Script", content: `"We have a special 'gift' that isn't on your program. To add a dash of starlight to our evening, please put your hands together for this **Surprise Number!**"` }
            ]
        },
        {
            seqNum: "XI",
            seqClass: "seq-num-top",
            header: { title: "Big Dreams Under the Tree", subtitle: "MAJOR RAFFLE DRAW" },
            sections: [
                { type: "intro-section", label: "The Script", content: `"The cold breeze is outside, but the heat is definitely rising in here! It’s time for the big ones, UNO-R! We are drawing our **Major Prizes**. Dan, Mark, get that raffle drum spinning! Who’s ready to win big?"` },
                { type: "thank-section", label: "Thank You", content: `"Wow! To our lucky Major winners—that is one way to have a Very Merry Christmas! Enjoy those incredible gifts!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "XII",
            seqClass: "seq-num-top",
            header: { title: "A Heart Full of Gratitude", subtitle: "MESSAGE FROM THE CHAIR" },
            sections: [
                { type: "intro-section", label: "The Script", content: `"As we prepare to close the formal part of our evening, let’s look to the guiding star of this event. To share his final thoughts on how we ‘Rise and Rebuild,’ please welcome the Chair of the 2025 Party—<b>Rev. Fr. Romeo ben A. Potencio, Jr., OAR.</b>"` },
                { type: "thank-section", label: "Thank You", content: `"Thank you, Fr. Ben! Your leadership has been the greatest ornament on our celebration tonight. We are truly grateful!"`, contentClass: "thank-text" }
            ]
        },
        {
            seqNum: "XIII",
            seqClass: "seq-num-top",
            header: { title: "The Star on Top of the Tree", subtitle: "GRAND RAFFLE DRAW" },
            sections: [
                { type: "bridge-section", label: "The Bridge", content: `"This is it... the moment that makes the reindeer fly and the sleigh bells ring!"`, contentClass: "bridge-text" },
                { type: "intro-section", label: "The Script", content: `"The tension is thicker than kalamayhati! It is time for our **Grand Raffle Prize**. Who is going home with the ultimate holiday blessing tonight? Let’s find out!"` }
            ]
        },
        {
            seqNum: "XIV",
            seqClass: "seq-num-top",
            header: { title: "A Symphony of Recoleto Hearts", subtitle: "UNIFIED VOICES" },
            sections: [
                { type: "intro-section", label: "The Script", content: `"Before we dance, let’s harmonize. As one family, let us lift our voices and fill this hall with the music of unity. Please stand and join us for our **Community Singing!**"` }
            ]
        },
        {
            seqNum: "XV",
            seqClass: "seq-num-top",
            seqStyle: "color:var(--unor-gold)",
            style: "background: var(--unor-blue);",
            header: { title: "Let the Yuletide Magic Begin", titleStyle: "color:var(--unor-gold)", subtitle: "FINAL CELEBRATION", subtitleStyle: "color:white" },
            sections: [
                { style: "text-align:center; border:none; background:rgba(255,255,255,0.1);", content: `"Merry Christmas, UNO-R family!<br><br><b>PARTY! PARTY! PARTY!</b>"`, contentStyle: "font-size: 1.8rem; color:var(--unor-gold); font-weight:800;" }
            ]
        }
    ];

    function showStatusModal(title, message) {
        document.getElementById('statusTitle').innerText = title;
        document.getElementById('statusMessage').innerText = message;
        document.getElementById('statusModal').style.display = 'block';
    }

    function loadFromFirebase() {
        if (!db) {
            console.warn("Firebase not configured. Using default data.");
            scriptData = JSON.parse(JSON.stringify(defaultScriptData));
            renderMainSlider();
            return;
        }

        let isConnected = false;

        db.collection("events").doc("xmas2025").onSnapshot((doc) => {
            if (!isConnected) {
                isConnected = true;
                showStatusModal("Success", "Firebase Connected Successfully!");
                setTimeout(() => closeModal('statusModal'), 2000);
            }
            if (doc.exists) {
                scriptData = doc.data().slides;
            } else {
                scriptData = JSON.parse(JSON.stringify(defaultScriptData));
                saveToFirebase();
            }
            renderMainSlider();
            if(document.getElementById('managerModal').style.display === 'block') {
                openSlideManager();
            }
        });
    }

    function saveToFirebase() {
        if (db) db.collection("events").doc("xmas2025").set({ slides: scriptData });
    }

    function renderMainSlider() {
        slider.innerHTML = scriptData.map(slide => {
            const seqClass = slide.seqClass || "seq-num";
            const seqStyle = slide.seqStyle || "";
            const slideStyle = slide.style || "";
            
            let headerHTML = `<div class="header"><h2>`;
            if (slide.header.badge) headerHTML += `<span class="vo-badge">${slide.header.badge}</span> `;
            headerHTML += `<span style="${slide.header.titleStyle || ''}">${slide.header.title}</span></h2>`;
            headerHTML += `<p style="${slide.header.subtitleStyle || ''}">${slide.header.subtitle}</p></div>`;

            let sectionsHTML = slide.sections.map(section => {
                const contentClass = section.contentClass || "";
                const deptListHTML = section.deptList ? `<div class="dept-list">${section.deptList}</div>` : "";
                return `
                <div class="section ${section.type || ''}" style="${section.style || ''}">
                    ${section.label ? `<span class="label">${section.label}</span>` : ''}
                    <div class="content ${contentClass}" style="${section.contentStyle || ''}">${section.content}</div>
                    ${deptListHTML}
                </div>`;
            }).join('');

            return `
            <div class="slide" style="${slideStyle}">
                <div class="${seqClass}" style="${seqStyle}">${slide.seqNum}</div>
                ${headerHTML}
                ${sectionsHTML}
            </div>`;
        }).join('');
    }

    // Initial Render
    loadFromFirebase();

    // Slide Manager Logic
    let currentEditIndex = -1;

    function openSlideManager() {
        const grid = document.getElementById('slideList');
        grid.innerHTML = '';
        scriptData.forEach((slide, index) => {
            const card = document.createElement('div');
            card.className = 'manager-card';
            card.innerHTML = `
                <div class="manager-card-content" onclick="openEditModal(${index})">
                    <h4>${slide.seqNum}</h4>
                    <p>${slide.header.title}</p>
                </div>
                <div class="card-controls">
                    <button onclick="moveSlideOrder(${index}, -1)" ${index === 0 ? 'disabled' : ''} title="Move Left">&#9664;</button>
                    <button class="btn-delete" onclick="deleteSlide(${index})" title="Delete">&#128465;</button>
                    <button onclick="moveSlideOrder(${index}, 1)" ${index === scriptData.length - 1 ? 'disabled' : ''} title="Move Right">&#9654;</button>
                </div>
            `;
            grid.appendChild(card);
        });
        
        const addBtn = document.createElement('div');
        addBtn.className = 'add-slide-btn';
        addBtn.innerHTML = '+ Add Slide';
        addBtn.onclick = addNewSlide;
        grid.appendChild(addBtn);

        document.getElementById('managerModal').style.display = 'block';
    }

    function moveSlideOrder(index, direction) {
        if (index + direction < 0 || index + direction >= scriptData.length) return;
        const temp = scriptData[index];
        scriptData[index] = scriptData[index + direction];
        scriptData[index + direction] = temp;
        saveToFirebase();
        renderMainSlider();
        openSlideManager();
    }

    function deleteSlide(index) {
        if(confirm('Delete this slide?')) {
            scriptData.splice(index, 1);
            saveToFirebase();
            renderMainSlider();
            openSlideManager();
        }
    }

    function addNewSlide() {
        scriptData.push({ seqNum: "NEW", style: "", header: { title: "New Slide", subtitle: "Subtitle" }, sections: [{ type: "intro-section", label: "Content", content: "Enter text here..." }] });
        saveToFirebase();
        renderMainSlider();
        openSlideManager();
    }

    function openEditModal(index) {
        currentEditIndex = index;
        const slide = scriptData[index];
        const form = document.getElementById('editForm');
        
        // Escape quotes to prevent syntax errors in template literal
        const safeTitle = slide.header.title.replace(/"/g, '&quot;');
        const safeSubtitle = slide.header.subtitle.replace(/"/g, '&quot;');

        form.innerHTML = `
            <div class="form-group"><label>Title</label><input type="text" id="editTitle" value="${safeTitle}"></div>
            <div class="form-group"><label>Subtitle</label><input type="text" id="editSubtitle" value="${safeSubtitle}"></div>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <div id="sectionsContainer"></div>
            <button type="button" class="add-slide-btn" style="min-height: 40px; margin-top: 10px; width: 100%;" onclick="addSectionToModal()">+ Add Section</button>
        `;

        const container = document.getElementById('sectionsContainer');
        slide.sections.forEach((section, sIndex) => {
            addSectionToModal(section);
        });

        document.getElementById('editModal').style.display = 'block';
    }

    function addSectionToModal(section = null) {
        const container = document.getElementById('sectionsContainer');
        const div = document.createElement('div');
        div.className = 'section-edit-group';
        
        const data = section || { type: 'intro-section', label: 'The Script', content: '' };
        
        const types = [
            { val: 'intro-section', txt: 'Intro (Blue)' },
            { val: 'bridge-section', txt: 'Bridge (Orange)' },
            { val: 'thank-section', txt: 'Thank You (Green)' },
            { val: 'section', txt: 'Generic' }
        ];
        
        const options = types.map(t => `<option value="${t.val}" ${data.type === t.val ? 'selected' : ''}>${t.txt}</option>`).join('');

        div.innerHTML = `
            <button type="button" class="btn-remove-section" onclick="this.parentElement.remove()" title="Remove Section">&#128465;</button>
            <div class="form-group">
                <label>Type</label>
                <select class="section-type-select">${options}</select>
            </div>
            <div class="form-group">
                <label>Label</label>
                <input type="text" class="section-label-input" value="${data.label || ''}">
            </div>
            <div class="form-group">
                <label>Content</label>
                <textarea class="section-content-input">${data.content || ''}</textarea>
            </div>
            <div class="form-group">
                <label>Dept. List (Optional)</label>
                <input type="text" class="section-dept-input" value="${data.deptList || ''}">
            </div>
        `;
        container.appendChild(div);
    }

    function saveSlide() {
        if (currentEditIndex === -1) return;
        const slide = scriptData[currentEditIndex];
        slide.header.title = document.getElementById('editTitle').value;
        slide.header.subtitle = document.getElementById('editSubtitle').value;
        
        // Rebuild sections array from DOM
        slide.sections = [];
        const sectionGroups = document.querySelectorAll('.section-edit-group');
        sectionGroups.forEach(group => {
            const type = group.querySelector('.section-type-select').value;
            const label = group.querySelector('.section-label-input').value;
            const content = group.querySelector('.section-content-input').value;
            const deptList = group.querySelector('.section-dept-input').value;
            
            let contentClass = "";
            if (type === 'bridge-section') contentClass = "bridge-text";
            if (type === 'thank-section') contentClass = "thank-text";

            const newSection = {
                type: type,
                label: label,
                content: content,
                contentClass: contentClass
            };
            if(deptList) newSection.deptList = deptList;
            
            slide.sections.push(newSection);
        });

        saveToFirebase();
        renderMainSlider();
        closeModal('editModal');
        openSlideManager();
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    window.onclick = function(e) { if (e.target.classList.contains('modal')) e.target.style.display = "none"; }
</script>
</body>
</html>